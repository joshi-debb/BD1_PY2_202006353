-- Descripcion: Script para el proyecto 2

-- CREAR BASE DE DATOS

CREATE SCHEMA IF NOT EXISTS BD1PY2;

-- SELECCIONAR BASE DE DATOS

USE BD1PY2;

-- CREAR TABLA CARRERA

CREATE TABLE IF NOT EXISTS BD1PY2.CARRERA (
    id_carrera INT NOT NULL AUTO_INCREMENT,
    nombre VARCHAR(30) NOT NULL,
    
    PRIMARY KEY (id_carrera)

);

-- CREAR TABLA ESTUDIANTE

CREATE TABLE IF NOT EXISTS BD1PY2.ESTUDIANTE (
    carnet VARCHAR(10) NOT NULL,
    dpi VARCHAR(20) NOT NULL,
    nombre VARCHAR(30) NOT NULL,
    apellido VARCHAR(30) NOT NULL,
    fecha_nac DATE NOT NULL,
    correo VARCHAR(100) NOT NULL,
    telefono VARCHAR(8) NOT NULL,
    direccion VARCHAR(100) NOT NULL,
    creditos INT NOT NULL,
    fecha DATE NOT NULL,
    id_carrera INT NOT NULL,
    
    PRIMARY KEY (carnet),
    FOREIGN KEY (id_carrera) REFERENCES BD1PY2.CARRERA(id_carrera)

);

-- CREAR TABLA DOCENTE

CREATE TABLE IF NOT EXISTS BD1PY2.DOCENTE (
    siif VARCHAR(10) NOT NULL,
    dpi VARCHAR(20) NOT NULL,
    nombre VARCHAR(30) NOT NULL,
    apellido VARCHAR(30) NOT NULL,
    fecha_nac DATE NOT NULL,
    correo VARCHAR(100) NOT NULL,
    telefono VARCHAR(8) NOT NULL,
    direccion VARCHAR(100) NOT NULL,
    fecha DATE NOT NULL,
    
    PRIMARY KEY (siif)

);

-- CREAR TABLA CURSO

CREATE TABLE IF NOT EXISTS BD1PY2.CURSO (
    cod_curso VARCHAR(10) NOT NULL,
    nombre VARCHAR(30) NOT NULL,
    creditos_nec INT NOT NULL,
    creditos_otg INT NOT NULL,
    obligatorio BOOLEAN NOT NULL,
    id_carrera INT NOT NULL,
    
    PRIMARY KEY (cod_curso),
    FOREIGN KEY (id_carrera) REFERENCES BD1PY2.CARRERA(id_carrera)

);

-- CREAR TABLA CURSO_HABILITADO

CREATE TABLE IF NOT EXISTS BD1PY2.CURSO_HABILITADO (
    id_ch VARCHAR(10) NOT NULL,
    cupo_max INT NOT NULL,
    seccion VARCHAR(2) NOT NULL,
    anio DATE NOT NULL,
    cod_curso VARCHAR(10) NOT NULL,
    siif VARCHAR(10) NOT NULL,
    
    PRIMARY KEY (id_ch),
    FOREIGN KEY (cod_curso) REFERENCES BD1PY2.CURSO(cod_curso),
    FOREIGN KEY (siif) REFERENCES BD1PY2.DOCENTE(siif)

);


-- CREAR TABLA HORARIO

CREATE TABLE IF NOT EXISTS BD1PY2.HORARIO (
    id_horaio INT NOT NULL AUTO_INCREMENT,
    dia VARCHAR(10) NOT NULL,
    hora TIME NOT NULL,
    id_ch VARCHAR(10) NOT NULL,
    
    PRIMARY KEY (id_horaio),
    FOREIGN KEY (id_ch) REFERENCES BD1PY2.CURSO_HABILITADO(id_ch)

);

-- CREAR TABLA ASIGNACION

CREATE TABLE IF NOT EXISTS BD1PY2.ASIGNACION (
    id_asignacion INT NOT NULL AUTO_INCREMENT,
    carnet VARCHAR(10) NOT NULL,
    id_ch VARCHAR(10) NOT NULL,

    PRIMARY KEY (id_asignacion),
    FOREIGN KEY (carnet) REFERENCES BD1PY2.ESTUDIANTE(carnet),
    FOREIGN KEY (id_ch) REFERENCES BD1PY2.CURSO_HABILITADO(id_ch)

);

-- CREAR TABLA DESASIGNACION

CREATE TABLE IF NOT EXISTS BD1PY2.DESASIGNACION (
    id_desasignacion INT NOT NULL AUTO_INCREMENT,
    carnet VARCHAR(10) NOT NULL,
    id_ch VARCHAR(10) NOT NULL,

    PRIMARY KEY (id_desasignacion),
    FOREIGN KEY (carnet) REFERENCES BD1PY2.ESTUDIANTE(carnet),
    FOREIGN KEY (id_ch) REFERENCES BD1PY2.CURSO_HABILITADO(id_ch)

);

-- CREAR TABLA ASIGNADOS

CREATE TABLE IF NOT EXISTS BD1PY2.ASIGNADOS (
    id_asignados INT NOT NULL AUTO_INCREMENT,
    cantidad INT NOT NULL,
    id_ch VARCHAR(10) NOT NULL,

    PRIMARY KEY (id_asignados),
    FOREIGN KEY (id_ch) REFERENCES BD1PY2.CURSO_HABILITADO(id_ch)

);



-- CREAR TABLA NOTA

CREATE TABLE IF NOT EXISTS BD1PY2.NOTA (
    id_nota INT NOT NULL AUTO_INCREMENT,
    nota INT NOT NULL,
    carnet VARCHAR(10) NOT NULL,
    id_ch VARCHAR(10) NOT NULL,

    PRIMARY KEY (id_nota),
    FOREIGN KEY (carnet) REFERENCES BD1PY2.ESTUDIANTE(carnet),
    FOREIGN KEY (id_ch) REFERENCES BD1PY2.CURSO_HABILITADO(id_ch)

);

-- CREAR TABLA ACTA

CREATE TABLE IF NOT EXISTS BD1PY2.ACTA (
    id_acta INT NOT NULL AUTO_INCREMENT,
    fecha DATE NOT NULL,
    hora TIME NOT NULL,
    id_ch VARCHAR(10) NOT NULL,

    PRIMARY KEY (id_acta),
    FOREIGN KEY (id_ch) REFERENCES BD1PY2.CURSO_HABILITADO(id_ch)

);

-- CREAR TABLA HISTORIAL

CREATE TABLE IF NOT EXISTS BD1PY2.HISTORIAL (
    id_historial INT NOT NULL AUTO_INCREMENT,
    fecha DATE NOT NULL,
    descripcion VARCHAR(100) NOT NULL,
    tipo VARCHAR(20) NOT NULL,

    PRIMARY KEY (id_historial)

);


-- Funciones y Procedimientos:

-- procedimiento para insertar carrera

DELIMITER $$
